%tbody
  - @modules.each do |barclamp_name, barclamp|
    %tr.barclamp
      - if not barclamp[:allow_multiple_proposals] or barclamp[:proposals].length == 0
        %td.col-xs-1.status
          - if barclamp[:proposals].length > 0
            - barclamp[:proposals].sort.each do |proposal_name, proposal|
              = display_led_for(proposal[:status], "#{barclamp_name.parameterize}_#{proposal_name.parameterize}")
          - else
            = display_led_for(:none, "#{barclamp_name.parameterize}_none")
        %td.col-xs-2
          = display_name_for(barclamp_name)
        %td.col-xs-9
          = barclamp[:description]
        %td.col-xs-1
          - if barclamp[:proposals].length == 0
            - create_proposal_form_for(barclamp_name) do
              = hidden_field_tag :barclamp, barclamp_name
              = hidden_field_tag :name, "default"
              = hidden_field_tag :description, t(".created_on", :date => l(Time.now))
              %input.btn.btn-default.form-control.input-sm{ :type => "submit", :value => t("proposal.actions.create") }
          - else
            = link_to t("proposal.actions.edit"), proposal_barclamp_path(:controller => barclamp_name, :id => barclamp[:proposals].first.first), :class => "btn btn-default form-control input-sm"
      - else
        %td.col-xs-1.status
          - if barclamp[:proposals].length > 0
            - barclamp[:proposals].sort.each do |proposal_name, proposal|
              = display_led_for(proposal[:status], "#{barclamp_name.parameterize}_#{proposal_name.parameterize}")
          - else
            = display_led_for(:none, "#{barclamp_name.parameterize}_none")
        %td.col-xs-2
          = display_name_for(barclamp_name)
        %td.col-xs-9
          = barclamp[:description]
        %td.col-xs-1
          = link_to t("proposal.actions.edit"), "#toggle", :class => (params[:id] == barclamp_name or barclamp[:expand]) ? "btn btn-default form-control input-sm expanded" : "btn btn-default form-control input-sm", "data-toggle-action" => barclamp_name

    - if barclamp[:allow_multiple_proposals] and not barclamp[:proposals].length == 0
      %tr{ :class => (params[:id] == barclamp_name or barclamp[:expand]) ? "proposal visible" : "proposal hidden", "data-toggle-target" => barclamp_name }
        %td{ :colspan => "4" }
          %table.table.table-condensed
            %tbody
              - barclamp[:proposals].sort.each do |proposal_name, proposal|
                %tr
                  %td.col-xs-1.status
                    = display_led_for(proposal[:status], "#{barclamp_name.parameterize}_#{proposal_name.parameterize}")
                  %td.col-xs-2
                    = proposal_name.titlecase
                  %td.col-xs-8
                    - if proposal[:status] == "failed"
                      = t(".failed", :message => proposal[:message])
                    - else
                      = proposal[:description].capitalize
                  %td.col-xs-1
                    = link_to t("proposal.actions.edit"), proposal_barclamp_path(:controller => barclamp_name, :id => proposal_name), :class => "btn btn-default form-control input-sm"
              - create_proposal_form_for(barclamp_name) do
                %tr
                  %td.col-xs-1.status
                    %span.glyphicon.glyphicon-plus
                  %td.col-xs-2
                    = text_field_tag :name, t("proposal.items.default"), :class => "form-control input-sm"
                  %td.col-xs-8
                    = text_field_tag :description, t(".created_on", :date => l(Time.now)), :class => "form-control input-sm"
                  %td.col-xs-1
                    = hidden_field_tag :barclamp, barclamp_name
                    %input.btn.btn-default.form-control.input-sm{ :type => "submit", :value => t("proposal.actions.create") }
